services:
  node:
    image: 'ghcr.io/Nolway/valorant-companion:bot-${TAG}'
    restart: always
    environment:
      NODE_ENV: 'production'
      MONGODB_USER: $MONGODB_USER
      MONGODB_PASS: $MONGODB_PASS
      MONGODB_DBNAME: $MONGODB_DBNAME
      BOT_TOKEN: $BOT_TOKEN
      REDIS_HOST: $REDIS_HOST
      REDIS_PORT: $REDIS_PORT
      REDIS_PASS: $REDIS_PASS
    depends_on:
      - mongo
    networks:
      - project
      - default
  mongo:
    image: mongo:7.0
    restart: always
    environment:
      MONGO_INITDB_DATABASE: $MONGODB_DBNAME
      MONGO_INITDB_ROOT_USERNAME: $MONGODB_USER
      MONGO_INITDB_ROOT_PASSWORD: $MONGODB_PASS
    networks:
      - project
  redis:
    image: redis:7.2
    restart: always
    volumes:
      - redisdata:/data
    environment:
      - REDIS_PASSWORD=${REDIS_PASS}
      - REDIS_PORT=${REDIS_PORT}
    networks:
      - project
networks:
  project:
    internal: true
  default:
    external:
      name: gateway
volumes:
  mongodata:
